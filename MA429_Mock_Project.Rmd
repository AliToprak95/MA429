---
title: "MA429 MOCK PROJECT"
output: MA429_html_notebook
---

```{r}
#Download the data from UCI Machine Learning Repository
test <- read.table("https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.test", skip=1, 
                   sep=",", header = FALSE,
                   col.names=c("Age", "Workclass", "Fnlwgt","Education","Education-num","Marital-status",
                               "Occupation","Relationship","Race","Sex",
                               "Capital-gain","Capital-loss","Hours-per-week","Native-country","Income-level"), na.strings = " ?")
train <- read.table("https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data",
                    sep=",", header = FALSE,
                    col.names=c("Age", "Workclass", "Fnlwgt","Education","Education-num","Marital-status",
                                "Occupation","Relationship","Race","Sex",
                                "Capital-gain","Capital-loss","Hours-per-week","Native-country","Income-level"), na.strings = " ?")


```


```{r}
#Create the whole dataset
censusdata <- rbind(train, test)
rm(train,test)

#Number of missing variables for each attribute
missingnumber <- function(col){sum(is.na(col))}
missings <- sapply(censusdata, missingnumber)
missings


levels(censusdata$Income.level) <- c(0,1,0,1)
str(censusdata)
summary(censusdata)
narow <- which(rowSums(is.na(censusdata))>0) 
length(narow)
census_complete <- censusdata[-narow,]
```

```{r}
library(ggplot2)
theme_set(theme_classic())

Raceplot <- ggplot(censusdata, aes(x=Race, y=(..count..)/sum(..count..), fill=Income.level)) + geom_bar(stat = "count") + coord_flip() + theme(text = element_text(size=20)) 




Ageplot <- ggplot(censusdata, aes(x=Age,fill=Income.level)) + geom_histogram(stat = "count") + theme(text = element_text(size=20))
library(ggpubr)
figure <- ggarrange(Raceplot,Ageplot,
                    labels = c("Race", "Age"),
                    ncol = 2)

```


```{r}
library(purrr)
library(tidyr)
library(ggplot2)

censusdata %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
  facet_wrap(~ key, scales = "free") +
  geom_histogram()

sapply(censusdata, class)
```


```{r}
#Age
attach(censusdata)
hist(Age,breaks=seq(min(Age),max(Age),by=1))
boxplot(Age)
install.packages("outliers")
library(outliers)
chisq.out.test(Age,variance = var(Age),opposite = TRUE)
chisq.out.test(Age,variance = var(Age),opposite = FALSE)
qqnorm(Age, main = "Normal QQ Plot - ylarge")
qqline(Age, col = "red")
```

```{r}
outlier_values <- boxplot.stats(Age)$out
boxplot(Age, main="Age", boxwex=0.1)
mtext(paste("Outliers: ", paste(outlier_values, collapse=", ")), cex=0.6)
qnt <- quantile(Age, probs=c(.25, .75), na.rm = T)
caps <- quantile(Age, probs=c(.05, .95), na.rm = T)
H <- 1.5 * IQR(Age, na.rm = T)
#censusdata[, censusdata$Age < (qnt[1] - H)]$Age <- caps[1]
#censusdata[, censusdata$Age > (qnt[2] + H)]$Age <- caps[2]
censusdata[which(censusdata$Age < (qnt[1] - H)),1] <- caps[1]
censusdata[which(censusdata$Age > (qnt[2] + H)),1] <- caps[2]
boxplot(censusdata$Age)
```
# Find outliers by boxplot
```{r}
numericdata <- censusdata[,sapply(census_complete, is.numeric)]
outlier_boxplot <- function(col){
outlier_values <- boxplot.stats(col)$out
length(outlier_values)
}
sapply(numericdata, outlier_boxplot)
```
# Find outliers by quantile
```{r}
outlier_qnt <- function(col){
qnt <- quantile(col, probs=c(.25, .75), na.rm = T)
caps <- quantile(col, probs=c(.05, .95), na.rm = T)
H <- 1.5 * IQR(col, na.rm = T)
length(which(col<(qnt[1] - H))) + length(which(col>(qnt[2] + H)))
}
sapply(numericdata,outlier_qnt)
```

# Plot the density of numeric variables with respect to the income level
```{r}
library(sm)
plotdata <- census_complete[,1:14]
income.f <- factor(census_complete$Income.level, labels = c("<= 50K", "> 50K"))
Plot <- function(col){
  sm.density.compare(col,group=census_complete$Income.level)
  colfill <- c(2:(2+length(levels(income.f))))
  legend("topright", levels(income.f), fill=colfill)
}
sapply(numericdata, Plot)
```

```{r}
library(scorecard)
bins = woebin(census_complete, y="Income.level", positive = "1" )
bins
```

#Prepare the final dataset
```{r}
# no Fnlwgt, Education, Capital Loss, Native country
censusbin <- census_complete
# Age data to woe
for (i in censusbin$Age) {
  if(i < 22) censusbin[which(censusbin$Age == i), 1] <- -4.9598526
  else if(i >= 22 & i < 28) censusbin[which(censusbin$Age == i), 1] <- -1.8199929
  else if(i >= 28 & i < 36) censusbin[which(censusbin$Age == i), 1] <- -0.1803384
  else censusbin[which(censusbin$Age == i), 1] <- 0.5066784
}

# Workclass data to woe
levels(censusbin$Workclass) <- c(0.3787722,0.3787722,0.4313100,-0.1689937,0.4313100,0.4313100,0.4313100,0.4313100)

# Education.num to woe
for (i in censusbin$Education.num) {
  if(i < 9) censusbin[which(censusbin$Education.num == i), 5] <- -1.6466314
  else if(i >= 9 & i < 13) censusbin[which(censusbin$Education.num == i), 5] <- -0.3491833
  else if(i >= 13 & i < 14) censusbin[which(censusbin$Education.num == i), 5] <- 0.7868101
  else censusbin[which(censusbin$Education.num == i), 5] <- 1.6011435
}

# Marital Status to woe
levels(censusbin$Marital.status)
levels(censusbin$Marital.status) <- c(-1.0432437,0.9264545,0.9264545,-1.8377340,-1.8377340,-1.3074208,-1.3074208)

# Occupation to woe
levels(censusbin$Occupation) <- c(-0.3876911,-0.3876911,-0.3876911,1.0265102,-1.0493693,-1.0493693,-1.0493693,-2.0814568,-2.0814568,0.9097133,0.0742908,0.0742908,0.0742908,0.0742908)

# Relationship to woe
levels(censusbin$Relationship) <- c(0.9326443,-1.0332987,-2.8108997,-2.8108997,-0.3295475,-0.3295475)

# Race to woe
levels(censusbin$Race) <- c(-0.55998280,-0.55998280,-0.55998280,-0.55998280,0.07646586)

# Sex to woe 
levels(censusbin$Sex)<- c(-0.9446077,0.3216005)

# Capital gain to woe
for (i in censusbin$Capital.gain) {
  if(i < 4000) censusbin[which(censusbin$Capital.gain == i), 11] <- -0.2088651
  else censusbin[which(censusbin$Capital.gain == i), 11] <- 2.6809686
}

# Hours per week to woe
for (i in censusbin$Hours.per.week) {
  if(i < 35) censusbin[which(censusbin$Hours.per.week == i), 13] <- -1.5001688
  else if(i >= 35 & i < 42) censusbin[which(censusbin$Hours.per.week == i), 13] <- -0.2069379
  else if(i >= 42 & i < 50) censusbin[which(censusbin$Hours.per.week == i), 13] <- 0.5038628
  else censusbin[which(censusbin$Hours.per.week == i), 13] <- 0.8265737
}

censusbin <- censusbin[,-c(3,4,12,14)]
```
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
