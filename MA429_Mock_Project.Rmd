---
title: "MA429 MOCK PROJECT"
output: MA429_html_notebook
---

```{r}
#Download the data from UCI Machine Learning Repository
test <- read.table("https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.test", skip=1, 
                   sep=",", header = FALSE,
                   col.names=c("Age", "Workclass", "Fnlwgt","Education","Education-num","Marital-status",
                               "Occupation","Relationship","Race","Sex",
                               "Capital-gain","Capital-loss","Hours-per-week","Native-country","Income-level"), na.strings = " ?")
train <- read.table("https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data",
                    sep=",", header = FALSE,
                    col.names=c("Age", "Workclass", "Fnlwgt","Education","Education-num","Marital-status",
                                "Occupation","Relationship","Race","Sex",
                                "Capital-gain","Capital-loss","Hours-per-week","Native-country","Income-level"), na.strings = " ?")


```


```{r}
#Create the whole dataset
censusdata <- rbind(train, test)
rm(train,test)

#Number of missing variables for each attribute
missingnumber <- function(col){sum(is.na(col))}
missings <- sapply(censusdata, missingnumber)

levels(censusdata$Income.level) <- c(0,1,0,1)
str(censusdata)
summary(censusdata)
narow <- which(rowSums(is.na(censusdata))>0) 
censusna <- censusdata[narow,]
```
```{r}
attach(censusdata)

g <- ggplot(censusdata, aes(x=Race,fill=Income.level))
g + geom_bar(stat = "count") 
```


```{r}
library(purrr)
library(tidyr)
library(ggplot2)

censusdata %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
  facet_wrap(~ key, scales = "free") +
  geom_histogram()

sapply(censusdata, class)
```


```{r}
#Age
attach(censusdata)
hist(Age,breaks=seq(min(Age),max(Age),by=1))
boxplot(Age)
install.packages("outliers")
library(outliers)
chisq.out.test(Age,variance = var(Age),opposite = TRUE)
chisq.out.test(Age,variance = var(Age),opposite = FALSE)
qqnorm(Age, main = "Normal QQ Plot - ylarge")
qqline(Age, col = "red")
```

```{r}
outlier_values <- boxplot.stats(Age)$out
boxplot(Age, main="Age", boxwex=0.1)
mtext(paste("Outliers: ", paste(outlier_values, collapse=", ")), cex=0.6)
qnt <- quantile(Age, probs=c(.25, .75), na.rm = T)
caps <- quantile(Age, probs=c(.05, .95), na.rm = T)
H <- 1.5 * IQR(Age, na.rm = T)
#censusdata[, censusdata$Age < (qnt[1] - H)]$Age <- caps[1]
#censusdata[, censusdata$Age > (qnt[2] + H)]$Age <- caps[2]
censusdata[which(censusdata$Age < (qnt[1] - H)),1] <- caps[1]
censusdata[which(censusdata$Age > (qnt[2] + H)),1] <- caps[2]
boxplot(censusdata$Age)
```
# Find outliers by boxplot
```{r}
outlier_boxplot <- function(col){
outlier_values <- boxplot.stats(col)$out
length(outlier_values)
}
sapply(numericdata, outlier_boxplot)
```
# Find outliers by quantile
```{r}
outlier_qnt <- function(col){
qnt <- quantile(col, probs=c(.25, .75), na.rm = T)
caps <- quantile(col, probs=c(.05, .95), na.rm = T)
H <- 1.5 * IQR(col, na.rm = T)
length(which(col<(qnt[1] - H))) + length(which(col>(qnt[2] + H)))
}
sapply(numericdata,outlier_qnt)
```

# Plot the density of numeric variables with respect to the income level
```{r}
library(sm)
plotdata <- censusdata[,1:14]
income.f <- factor(censusdata$Income.level, labels = c("<= 50K", "> 50K"))
Plot <- function(col){
  sm.density.compare(col,group=censusdata$Income.level)
  colfill <- c(2:(2+length(levels(income.f))))
  legend("topright", levels(income.f), fill=colfill)
}
sapply(numericdata, Plot)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
